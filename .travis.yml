---
# vim: set ff=unix ts=2 sw=2 sts=2 et : This line is VIM modeline

language: python
python: "2.7"

# Use the new container infrastructure
sudo: false

# Install ansible
addons:
  apt:
    packages:
    - python-pip

install:
  # Install ansible
  - pip install ansible

  # Check ansible version
  - ansible --version

  # Check bash version
  - bash --version

  ## Create ansible.cfg with correct roles_path
  #- printf '[defaults]\nroles_path=../' >ansible.cfg

script:
  # Install shell
  - |
    set -x;
    : "install.sh" && {
      bash -n install.sh &&
      bash install.sh -D --install --source=$(pwd)/roles/bashrc && {
        [ -d "${HOME}/.config/bash.bashrc.d" ] &&
        [ -r "${HOME}/.config/bash.bashrc"   ] &&
        [ -r "${HOME}/.config/bash.profile"  ] &&
        . "${HOME}/.bashrc" && {
          [ -n "$osvendor" ] && echo "osvendor=$osvendor" &&
          [ -n "$ostype"   ] && echo "ostype=$ostype"     &&
          [ -n "$machine"  ] && echo "machine=$machine"   &&
        :; }
    } &&
    : "OK";

  # Basic role syntax check
  - |
    cd roles/bashrc/tests/ &&
    ansible-playbook -i inventory test.yml --syntax-check

# Notifications
#notifications:
#  email:
#  - your@emailaddress

