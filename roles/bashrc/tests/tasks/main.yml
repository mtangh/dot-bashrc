---
# unit test role tasks file
# vim: set ff=unix ts=2 sw=2 sts=2 et : This line is VIM modeline

- name: "{{ tests_casename|d('noname',true) }} | Test '{{ tests_task|d('???',true) }}'."
  fail:
    msg: "Cannot run tests: tests_run=[{{ tests_run|d(none) }}], tests_task=[{{ tests_task|d('???') }}]."
  when: tests_run|d(false,true) == false
        and (tests_task|d(none,true) is not string
          or tests_task|trim|lower|match('^(setup|teardown)$') == false)

- block:

  - name: "{{ tests_casename|d('noname',true) }} | Include '{{ _tests_tasks_file|d('???',true) }}'."
    include_tasks:
      file: "{{ _tests_tasks_file }}"
    when: _tests_tasks_file|d(none) is not none
    no_log: "{{ _tests_tasks_file|d(none) is none }}"

  when: tests_run|d(false,true)
        and tests_task|d(none,true) is string
        and tests_task|trim|lower|match('^(setup|teardown)$')
  vars:
    _tests_tasks_file: "{{
      'tests-%s.yml'|format(tests_task|trim|lower)
      if tests_task|d(none,true) is string
      and tests_task|trim|lower|match('^(setup|teardown)$') else
      none }}"

