---
# test-teardown tasks file
# vim: set ff=unix ts=2 sw=2 sts=2 et : This line is VIM modeline

- block:

  - name: "{{ tests_casename|d('noname',true) }} | test-terdown | validate"
    shell: |
      diff -Nur {{ tests_ignore_validation_files|d('',true) }}\
        -I '^# Ansible managed:.*$' \
        "{{ tests_files_expects_dir_for_case }}" \
        "{{ tests_prefix_dir }}"
    when: tests_files_expects_dir_for_case|d('-',true)|is_dir
    vars:
      tests_files_expects_dir_for_case: "{{
        '%s/%s'|format(tests_files_expects_dir|d('-',true),tests_casename|d('',true)) }}"
    changed_when: no
    no_log: "{{ tests_files_expects_dir_for_case|d('-',true)|is_diris_dir == false }}"

  - name: "{{ tests_casename|d('noname',true) }} | test-teardown | Task for case."
    include_tasks:
      file: "{{ tests_tasks_teardown_file }}"
    with_flatten: "{{ tests_tasks_teardown_file_list|d([]) }}"
    loop_control:
      loop_var: tests_tasks_teardown_file
    when: tests_tasks_teardown_file_list|d([])|length > 0
          and tests_tasks_teardown_file|d('',true)|is_file == true
    no_log: "{{ tests_tasks_teardown_file_list|d([])|length <= 0
                or tests_tasks_teardown_file|d('',true)|is_file == false  }}"

  when: tests_run|d(false,true)
        and tests_casename|d('',true)|string|trim|length > 0
        and tests_prefix_dir|d('',true)|string|trim|length > 0
  tags:
  - '[test-teardown]'

