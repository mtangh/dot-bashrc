---
# test-setup tasks file
# vim: set ff=unix ts=2 sw=2 sts=2 et : This line is VIM modeline

- block:

  - name: "test-setup | create directories for case '{{ test_casename }}'"
    file:
      path: "{{ '%s%s'|format(prefix_dir,item.path|d(item)) }}"
      state: directory
      owner: "{{ item.owner|d(test_owner) }}"
      group: "{{ item.group|d(test_group) }}"
      mode: "{{ item.mode|d('0755') }}"
    with_items: "{{ _test_setup_dirs|d([]) }}"
    when: item|d(none) is not none
          or item.path|d(none) is not none

  vars:
    _test_setup_dirs:
    - /etc
    - /etc/profile.d
    - "{{ bashrc_install_prefix|d(none) }}"
    
  when: test_run|d(none) is not none
        and prefix_dir|d('')|length > 0
  tags:
  - '[test-setup]'

- block:

  - name: "test-setup | create bashrc files for test"
    copy:
      src: "{{ '%s/%s'|format(_test_setup_src,item.path|d(item)) }}"
      dest: "{{ '%s/etc/%s'|format(prefix_dir,item.path|d(item)) }}"
      owner: "{{ item.owner|d(test_owner) }}"
      group: "{{ item.group|d(test_group) }}"
      mode: "0644"
    ignore_errors: true
    with_items: 
    - bashrc
    - profile

  vars:
    _test_setup_src: "{{ '%s/files/etc'|format(test_setup_dir) }}"
  when: test_run|d(none) is not none
        and prefix_dir is defined
  tags:
  - '[test-setup]'

