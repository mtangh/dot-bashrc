---
# test-setup defaults file
# vim: set ff=unix ts=2 sw=2 sts=2 et : This line is VIM modeline

tests_run: "{{
    inventory_hostname_short|d('-',true)
    in ((groups|d({},true)).testcases|d([],true)) }}"

# test case name
tests_casename: "{{
    (tests_run|d(false,true))|ternary((
    inventory_hostname_short|string|trim
    if inventory_hostname_short|d('',true)|string|trim|length > 0 else
    lookup('pipe','mktemp -u testcase_XXXXXXXX')
    ),none) }}"

# test owner and group
tests_owner: "{{
    (tests_run|d(false,true))|ternary(lookup('pipe','id -un'),none) }}"
tests_group: "{{
    (tests_run|d(false,true))|ternary(lookup('pipe','id -gn'),none) }}"

# dirs.
tests_root_dir: "{{
    (tests_run|d(false,true))|ternary((
    '%s/%s'|format(
    (inventory_dir|string|trim|match('^[.]'))|ternary(ansible_env.PWD,''),
    inventory_dir|string|trim|regex_replace('^[.](/$|$)','')
    )|realpath
    if inventory_dir|d('',true)|string|trim|length > 0 else
    '%s/%s'|format(
    (playbook_dir|string|trim|match('^[.]'))|ternary(ansible_env.PWD,''),
    playbook_dir|string|trim|regex_replace('^[.](/$|$)','')
    )|realpath
    if playbook_dir|d('',true)|string|trim|length > 0 else
    ansible_env.PWD
    ),none) }}"

tests_setup_dir: "{{
    (tests_run|d(false,true))|ternary(
    '%s/test-setup'|format(tests_root_dir),none) }}"
tests_teardown_dir: "{{
    (tests_run|d(false,true))|ternary(
    '%s/test-teardown'|format(tests_root_dir),none) }}"

tests_files_dir: "{{
    (tests_run|d(false,true))|ternary(
    '%s/files'|format(tests_root_dir),none) }}"
tests_files_setup_dir: "{{
    (tests_run|d(false,true))|ternary(
    '%s/setup'|format(tests_files_dir),none) }}"
tests_files_expects_dir: "{{
    (tests_run|d(false,true))|ternary(
    '%s/expects'|format(tests_files_dir),none) }}"

tests_tasks_dir: "{{
    (tests_run|d(false,true))|ternary(
    '%s/tasks'|format(tests_root_dir),none) }}"

tests_vars_dir: "{{
    (tests_run|d(false,true))|ternary(
    '%s/vars'|format(tests_root_dir),none) }}"

tests_target_dir: "{{
    (tests_run|d(false,true))|ternary(
    '%s/target'|format(tests_root_dir),none) }}"

# root dir of test case
tests_prefix_dir: "{{
    (tests_run|d(false,true))|ternary((
    prefix_dir|string|trim
    if prefix_dir|d('',true)|string|trim|length > 0 else
    '%s/%s'|format(tests_target_dir,tests_casename)
    if tests_casename|d('',true)|string|trim|length > 0 else
    none
    ),none) }}"

# lists
tests_vars_file_list:
- "{{ '%s/main.yml'|format(tests_vars_dir|d('.',true)) }}"
- "{{ '%s/%s.yml'|format(tests_vars_dir|d('.',true),tests_casename|d('default',true)) }}"

tests_files_setup_dir_list:
- "{{ '%s/%s'|format(tests_files_setup_dir|d('.',true),tests_casename|d('default',true)) }}"
- "{{ '%s/default'|format(tests_files_setup_dir|d('.',true)) }}"

tests_tasks_file_list:
- "{{ '%s/main.yml'|format(tests_tasks_dir) }}"
- "{{ '%s/%s.yml'|format(tests_tasks_dir,tests_casename|d('default',true)) }}"

tests_tasks_setup_file_list:
- "{{ '%s/setup/main.yml'|format(tests_tasks_dir) }}"
- "{{ '%s/setup/%s.yml'|format(tests_tasks_dir,tests_casename|d('default',true)) }}"
- "{{ tests_tasks_file_list }}"

tests_tasks_teardown_file_list:
- "{{ '%s/teardown/main.yml'|format(tests_tasks_dir) }}"
- "{{ '%s/teardown/%s.yml'|format(tests_tasks_dir,tests_casename|d('default',true)) }}"
- "{{ tests_tasks_file_list }}"

