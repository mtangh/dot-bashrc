#!/bin/bash
# $Id$
THIS="${0##*/}"
CDIR=$([ -n "${0%/*}" ] && cd "${0%/*}" 2>/dev/null; pwd)

# PATH
PATH=/usr/bin:/bin
export PATH

# user template dir.
if [ -d "$1" ]
then
  tmplt_dir=$(cd "$1" 2>/dev/null && pwd)
fi
if [ ! -d "$tmplt_dir" ]
then
  echo "$THIS: '$1': no such file or directory." 1>&2
  exit 1
fi

# user home
if [ -d "$2" ]
then
  user_home=$(cd "$2" 2>/dev/null && pwd)
else
  user_home="$HOME"
fi
if [ ! -d "$user_home" ]
then
  echo "$THIS: '$user_home': no such file or directory." 1>&2
  exit 1
fi

# setup directories
for _dir_ in \
$(cd $tmplt_dir && find . -type d|sort 2>/dev/null)
do

  _dir_="${_dir_//\/dot.//.}"
  _dir_="${_dir_#*/}"

  [ -n "$_dir_" ] &&
    mkdir -p "$user_home/$_dir_" 2>/dev/null

done

# setup skelton file(s)
for _src_ in \
$(cd $tmplt_dir; find . -type f|sort 2>/dev/null)
do

  _dst_="${_src_//\/dot.//.}"
  _dst_="${_dst_#*/}"

  [ -n "$_dst_" ] ||
    continue

  echo "$THIS: copying '$_dst_'."

  _dir_="./${_dst_}"
  _dir_="${_dir_%/*}"

  [ -n "$_dir_" -a "$_dir_" != "." ] &&
    mkdir -p "$user_home/$_dir_" 2>/dev/null

  [ -e "$user_home/$_dst_" ] ||
    cp -f "$tmplt_dir/$_src_" "$user_home/$_dst_" 2>/dev/null

done

# "$HOME/.bashrc" not exists, create file
if [ ! -e "$user_home/.bashrc" ]
then

  echo "$THIS: creating '$user_home/.bashrc'."

  cat <<-__EOF__ 1>$user_home/.bashrc 2>/dev/null
# \$HOME/.bashrc
# User local .bashrc file
[ -r "/etc/bash.bashrc" ] &&
  . "/etc/bash.bashrc"

# Aliases


# *eof*
__EOF__

fi

# clean up
unset tmplt_dir
unset user_home
unset _dir_
unset _src_
unset _dst_

# end of shell
exit 0
